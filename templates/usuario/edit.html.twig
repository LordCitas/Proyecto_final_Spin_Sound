{% extends 'base.html.twig' %}

{% block title %}Editar Perfil - Spin&Sound{% endblock %}

{% block body %}
<main class="flex-1 animate-reveal">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="max-w-3xl mx-auto">
            <!-- Header con Avatar -->
            <div class="mb-8">
                <div class="flex items-center gap-6 mb-6">
                    <a href="{{ path('app_usuario_show', {id: usuario.id}) }}" class="p-2 hover:bg-surface-dark rounded-lg transition-colors" title="Volver al perfil">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
                        </svg>
                    </a>
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-[#e00000] to-[#a00000] flex items-center justify-center">
                        <span class="text-3xl font-bold text-white">{{ usuario.nombre|slice(0, 1)|upper }}</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight">Editar Perfil</h1>
                        <p class="text-sm text-on-surface-muted-dark">{{ usuario.email }}</p>
                    </div>
                </div>
            </div>

            <!-- Formulario con Iconos -->
            <div class="bg-surface-dark border border-gray-800 rounded-lg overflow-hidden">
                <!-- Header del Formulario -->
                <div class="bg-gradient-to-r from-[#e00000] to-[#a00000] px-8 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"></path>
                        </svg>
                        Información Personal
                    </h2>
                </div>
                
                <!-- Contenido del Formulario -->
                <div class="p-8">
                    {{ include('usuario/_form.html.twig', { button_label: 'Guardar Cambios', usuario: usuario }) }}
                </div>
            </div>

            <!-- Información Adicional -->
            <div class="mt-6 bg-blue-900/10 border border-blue-900/50 rounded-lg p-4">
                <div class="flex items-start gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#3b82f6" viewBox="0 0 256 256" class="flex-shrink-0 mt-0.5">
                        <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path>
                    </svg>
                    <div class="text-sm">
                        <p class="font-semibold text-blue-300 mb-1">Información importante</p>
                        <p class="text-blue-200/80">Los cambios se guardarán inmediatamente. Asegúrate de que toda la información sea correcta antes de guardar.</p>
                    </div>
                </div>
            </div>

            <!-- Cambiar Contraseña -->
            <div class="mt-6 bg-surface-dark border border-gray-800 rounded-lg overflow-hidden">
                <div class="bg-gradient-to-r from-[#e00000] to-[#a00000] px-8 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96ZM208,208H48V96H208V208Zm-68-56a12,12,0,1,1-12-12A12,12,0,0,1,140,152Z"></path>
                        </svg>
                        Cambiar Contraseña
                    </h2>
                </div>
                <div class="p-8">
                    <form method="post" action="{{ path('app_usuario_change_password', {id: usuario.id}) }}" class="space-y-4">
                        <input type="hidden" name="_token" value="{{ csrf_token('change-password' ~ usuario.id) }}">
                        
                        <div>
                            <label class="block text-sm font-semibold text-white mb-2">Contraseña Actual</label>
                            <input type="password" name="current_password" required class="w-full px-4 py-3 bg-[#0b0f13] border border-gray-700 rounded-lg text-white focus:border-[#e00000] focus:outline-none focus:ring-2 focus:ring-[#e00000]/20">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-white mb-2">Nueva Contraseña</label>
                            <input type="password" name="new_password" required minlength="8" class="w-full px-4 py-3 bg-[#0b0f13] border border-gray-700 rounded-lg text-white focus:border-[#e00000] focus:outline-none focus:ring-2 focus:ring-[#e00000]/20">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-white mb-2">Confirmar Nueva Contraseña</label>
                            <input type="password" name="confirm_password" required minlength="8" class="w-full px-4 py-3 bg-[#0b0f13] border border-gray-700 rounded-lg text-white focus:border-[#e00000] focus:outline-none focus:ring-2 focus:ring-[#e00000]/20">
                        </div>
                        
                        <button type="submit" class="text-white font-bold px-6 py-3 rounded-lg transition-all" style="background-color: #e00000;">
                            Cambiar Contraseña
                        </button>
                    </form>
                </div>
            </div>

            <!-- Zona de Peligro -->
            <div class="mt-6 bg-surface-dark border border-red-900/50 rounded-lg overflow-hidden">
                <div class="bg-gradient-to-r from-red-600 to-red-800 px-8 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"></path>
                        </svg>
                        Zona de Peligro
                    </h2>
                </div>
                <div class="p-8">
                    <div class="flex items-start justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-2">Eliminar Cuenta</h3>
                            <p class="text-sm text-on-surface-muted-dark">Una vez eliminada tu cuenta, no hay vuelta atrás. Por favor, está seguro.</p>
                        </div>
                        <button onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-lg transition-all flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192Z"></path>
                            </svg>
                            Eliminar Cuenta
                        </button>
                    </div>
                    
                    <form id="delete-form" method="post" action="{{ path('app_usuario_delete', {id: usuario.id}) }}" class="hidden">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ usuario.id) }}">
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modal de Confirmación de Eliminación -->
<div id="delete-modal" class="fixed inset-0 z-[200] hidden">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeDeleteModal()"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
        <div class="relative bg-surface-dark border border-red-900/50 rounded-lg max-w-md w-full">
            <div class="bg-gradient-to-r from-red-600 to-red-800 px-6 py-4">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"></path>
                    </svg>
                    Confirmar Eliminación
                </h2>
            </div>
            <div class="p-6">
                <p class="text-white mb-4">¿Estás seguro de que deseas eliminar tu cuenta?</p>
                <p class="text-sm text-on-surface-muted-dark mb-6">Esta acción no se puede deshacer. Todos tus datos serán eliminados permanentemente.</p>
                <div class="flex gap-4">
                    <button onclick="confirmDeleteAction()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-lg transition-all">
                        Sí, eliminar
                    </button>
                    <button onclick="closeDeleteModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold px-6 py-3 rounded-lg transition-all">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete() {
    document.getElementById('delete-modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeDeleteModal() {
    document.getElementById('delete-modal').classList.add('hidden');
    document.body.style.overflow = 'auto';
}

function confirmDeleteAction() {
    document.getElementById('delete-form').submit();
}
</script>
{% endblock %}
